---
import { Image } from "astro:assets";

interface TextContent {
    type: "text";
    value: string | number;
}

const DEFAULT_IMAGE_SIZE = 36;
interface ImageContent {
    type: "image";
    src: string;
    alt: string;
    width?: number;
    height?: number;
}

type CellContent = TextContent | ImageContent;

interface DataRow {
    [key: string]: CellContent | string | number;
}

interface Props {
    data: DataRow[];
    headers?: string[];
    className?: string;
}

const { data = [], headers, className = "" } = Astro.props as Props;
const computedHeaders: string[] =
    headers ?? (data[0] ? Object.keys(data[0]) : []);
---

<div class="starlight-table">
    <table class={className}>
        <thead>
            <tr>
                {computedHeaders.map((header) => <th>{header}</th>)}
            </tr>
        </thead>
        <tbody>
            {
                data.map((row) => (
                    <tr>
                        {computedHeaders.map((header) => {
                            const cell = row[header];
                            return (
                                <td>
                                    {typeof cell === "object" &&
                                    cell.type === "text" ? (
                                        cell.value
                                    ) : typeof cell === "object" &&
                                      cell.type === "image" ? (
                                        <Image
                                            src={cell.src}
                                            alt={cell.alt}
                                            width={
                                                cell.width || DEFAULT_IMAGE_SIZE
                                            }
                                            height={
                                                cell.height ||
                                                DEFAULT_IMAGE_SIZE
                                            }
                                        />
                                    ) : (
                                        cell
                                    )}
                                </td>
                            );
                        })}
                    </tr>
                ))
            }
        </tbody>
    </table>
</div>

<style>
    .starlight-table {
        overflow-x: auto;
        margin: var(--sl-nav-pad-x) 0;
        border-radius: 0.5rem;
        box-shadow: var(--sl-shadow-sm);
        overflow: hidden;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        background: var(--sl-color-bg);
        font-family: var(--__sl-font);
        font-size: var(--sl-text-sm);
        line-height: var(--sl-line-height);
    }

    th {
        background: linear-gradient(
            to bottom,
            var(--sl-color-gray-6),
            var(--sl-color-gray-5)
        );
        color: var(--sl-color-gray-1);
        font-weight: 500;
        padding: var(--sl-nav-pad-x);
        text-align: left;
        border-bottom: 1px solid var(--sl-color-hairline-light);
    }

    td {
        padding: var(--sl-nav-pad-x);
        color: var(--sl-color-gray-4);
        border-bottom: 1px solid var(--sl-color-hairline-light);
        display: table-cell;
        vertical-align: middle;
    }

    td img {
        display: block;
        margin: 0 auto;
    }

    tr:hover {
        background: var(--sl-color-gray-2);
        box-shadow: var(--sl-shadow-sm);
    }

    tr:last-child td {
        border-bottom: none;
    }

    @media (max-width: 640px) {
        th,
        td {
            white-space: nowrap;
            min-width: 120px;
            font-size: 12px;
        }
    }

    @media (prefers-color-scheme: dark) {
        .starlight-table {
            box-shadow: var(--sl-shadow-sm);
        }

        table {
            background: var(--sl-color-bg);
        }

        th {
            background: linear-gradient(
                to bottom,
                var(--sl-color-gray-5),
                var(--sl-color-gray-6)
            );
            color: var(--sl-color-gray-2);
            border-bottom-color: var(--sl-color-hairline);
        }

        td {
            color: var(--sl-color-gray-3);
            border-bottom-color: var(--sl-color-hairline);
        }

        tr:hover {
            background: var(--sl-color-gray-7);
            box-shadow: var(--sl-shadow-sm);
        }
    }
</style>
